<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"/><meta http-equiv="X-UA-Compatible" content="IE=edge"/><meta name="HandheldFriendly" content="True"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><meta name="description" content="Cheatsheet for cassandra"/><meta property="og:description" content="Cheatsheet for cassandra"/><meta property="og:site_name" content="tech.joshegan.com"/><meta property="og:title" content="Cassandra Cheatsheet - tech.joshegan.com"><title>Cassandra Cheatsheet - tech.joshegan.com</title><meta property="og:url" content="http://tech.joshegan.com/posts/yr2016/cassandra-cheatsheet"><meta property="og:type" content="article"><link rel="stylesheet" type="text/css" href="/styles/third-party/google-fonts/css/google-fonts.css"/><link rel="stylesheet" type="text/css" href="/styles/third-party/font-awesome-4.3.0/css/font-awesome.min.css"/><link rel="stylesheet" type="text/css" href="/styles/main.css"/><link rel="stylesheet" type="text/css" href="/styles/third-party/highlight-js/hybrid.css"><script src="/scripts/sidebar-opacity.js"></script></head><body id="body" class="post-wrapper"><header class="nav mobile-nav"><a href="/"><i class="fa fa-home fa-2x"></i><span>tech.joshegan.com</span></a></header><article class="post"><h1><a href="http://tech.joshegan.com/posts/yr2016/cassandra-cheatsheet">Cassandra Cheatsheet</a></h1><p></p>Posted on<time datetime="2016-04-18" class="orange"><strong> April 18th, 2016</strong></time><h1></h1>
<h2>Cassandra Resources</h2>
<ul>
<li><a href="https://cassandra.apache.org/">https://cassandra.apache.org/</a></li>
<li><a href="https://app.pluralsight.com/library/courses/cassandra-developers">https://app.pluralsight.com/library/courses/cassandra-developers</a></li>
</ul>
<h2>About Cassandra</h2>
<h3>History</h3>
<ul>
<li>Originally created at Facebook.</li>
<li>Open sourced and now an official apache project.</li>
</ul>
<h3>When to use Cassandra</h3>
<p>Cassandra is a great choice for a database when...</p>
<ul>
<li>Speed is the top goal and eventual consistency is acceptable.</li>
<li>Table schema is stable and unlikely to change.</li>
</ul>
<h3>Terminology</h3>
<table>
<thead>
<tr>
<th>Term</th>
<th>Meaning</th>
</tr>
</thead>
<tbody>
<tr>
<td>node</td>
<td>A server running an instance of cassandra.</td>
</tr>
<tr>
<td>vnode</td>
<td>A virtual node. Virtual nodes are used to distribute token values on a single physical node.</td>
</tr>
<tr>
<td>dc</td>
<td>A data center is a grouping of nodes. Each data center has its own set of tokens.</td>
</tr>
<tr>
<td>rack</td>
<td>Each node in a data center is part of a rack. Racks do not require an even distribution of nodes. Data center replication will be evenly distributed among racks. Each rack will evenly distribute the replication among the nodes on the rack.</td>
</tr>
<tr>
<td>keyspace</td>
<td>Data is organized at the highest level into keyspaces. The oracle or mysql analog is tablespace. Replication is specified at the keyspace level.</td>
</tr>
<tr>
<td>table</td>
<td>Pretty close to mysql definition - columns are defined, and rows of data are stored in the table.</td>
</tr>
<tr>
<td>partition</td>
<td>All data is associated with a partition key. A table contains partitions.</td>
</tr>
<tr>
<td>row</td>
<td>Also close to mysql definition. Rows represent data within paritions.</td>
</tr>
</tbody>
</table>
<h2>Setting up a Cassandra cluster</h2>
<h3>Creating cassandra nodes</h3>
<table>
<thead>
<tr>
<th>Option</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>--seeds</code></td>
<td>When adding a new node to an existing Cassandra cluster, the new node should be initialized with a comma separated list of ip addresses of existing nodes using <code>-seeds &lt;ip-address-1&gt;,&lt;ip-address-2&gt;</code></td>
</tr>
<tr>
<td><code>-dc</code></td>
<td>Give a name of the data center. e.g. <code>-dc DC-1</code></td>
</tr>
<tr>
<td><code>-rack</code></td>
<td>Give the rack name. e.g. <code>-rack R-1</code></td>
</tr>
</tbody>
</table>
<h3>cassandra.yaml</h3>
<p>Cassandra configuration is stored in <code>cassandra.yaml</code> file. By default this file is located at <code>/data/conf/cassandra.yaml</code>.</p>
<table>
<thead>
<tr>
<th>Property</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>num_tokens</code></td>
<td>The number of virtual nodes, <code>vnodes</code>, to use in this node. Default is 256.</td>
</tr>
<tr>
<td><code>seed_provider</code></td>
<td>Defines the seeds for the node.</td>
</tr>
<tr>
<td><code>endpoint_snitch</code></td>
<td>The snitch type for the node.</td>
</tr>
</tbody>
</table>
<h3>cassandra-rackdc.properties</h3>
<p>By default, this file is located at <code>/data/conf/cassandra-rackdc.properties</code></p>
<p>The <code>dc</code> (data center) and <code>rack</code> are stored in this properties file. This file is read in at node start-up and gossiped out to the other nodes in the cluster.</p>
<h2>Working with cassandra</h2>
<h3>CQLSH</h3>
<p>The cqlsh command line utility allows for interacting with Cassandra directly.</p>
<table>
<thead>
<tr>
<th>Command</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>cqlsh</code></td>
<td>Launch the shell and connect to the default node. Default is <code>localhost:9160</code>; this can be changed by setting <code>$CQLSH_HOST</code> and/or <code>$CQLSH_PORT</code></td>
</tr>
<tr>
<td><code>cqlsh &lt;address&gt;</code></td>
<td>Connect to a remote node. The address can be an ip address or a url.</td>
</tr>
<tr>
<td><code>cqlsh &lt;address&gt; -u &lt;user-name&gt;</code></td>
<td>Connect to a remote with the specified user. This will open up an interactive prompt if a password is required.</td>
</tr>
<tr>
<td><code>cqlsh &lt;address&gt; -u &lt;user-name&gt; -p &lt;password&gt;</code></td>
<td>Authenticated remote login. Note that password will be visible as plain text on console if <code>-p</code> is used.</td>
</tr>
<tr>
<td><code>cqlsh -f &lt;file-path.cql&gt;</code></td>
<td>Execute commands from the file and then exit.</td>
</tr>
<tr>
<td><code>cqlsh -e &quot;&lt;cql-command&gt;&quot;</code></td>
<td>Execute a CQL command and then exit. For example, <code>cqlsh -e &quot;SELECT id FROM sample_keyspace.my_table&quot;</code></td>
</tr>
<tr>
<td><code>cqlsh --cqlversion=&lt;version&gt;</code></td>
<td>Use the specified version of CQL. For example, <code>cqlsh --cqlversion=3.0.3</code></td>
</tr>
</tbody>
</table>
<p>Once inside of a cqlsh prompt, these commands are available:</p>
<table>
<thead>
<tr>
<th>Command</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>help</code></td>
<td>Show the help docs.</td>
</tr>
<tr>
<td><code>use &lt;keyspace&gt;</code></td>
<td>Use the specified keyspace. Allows accessing tables without prefixing with <code>keyspace.</code>.</td>
</tr>
<tr>
<td><code>tracing &lt;on/off&gt;</code></td>
<td>Turn tracing on or off</td>
</tr>
<tr>
<td><code>nodetool</code></td>
<td>Useful tool for interacting with nodes. The <code>nodetool</code> command can be run from cqlsh on any node in the cluster and will yield the same results.</td>
</tr>
<tr>
<td><code>nodetool help</code></td>
<td>Display help docs.</td>
</tr>
<tr>
<td><code>nodetool status</code></td>
<td>Shows the status of the cassandra nodes in the cluster</td>
</tr>
<tr>
<td><code>nodetool status &lt;keyspace&gt;</code></td>
<td>Shows the status of the cassandra nodes that own the specified keyspace.</td>
</tr>
<tr>
<td><code>nodetool ring</code></td>
<td>Shows the token ranges for the node. Each row represents a <code>vnode</code></td>
</tr>
<tr>
<td><code>nodetool describering &lt;keyspace&gt;</code></td>
<td>Shows the token ranges where all data would go for the specified keyspace.</td>
</tr>
<tr>
<td><code>nodetool repair</code></td>
<td>Repair inconsistencies in data across nodes.</td>
</tr>
<tr>
<td><code>nodetool pausehandoff</code></td>
<td>Pauses automatic hand-offs, or data repair. Can be useful when trying to trace hand-offs.</td>
</tr>
<tr>
<td><code>nodetool cfstats &lt;table-name&gt;</code></td>
<td>Displays detailed stats on the table, including read and write activity. Useful for ensuring that a table really is not in use before dropping it.</td>
</tr>
</tbody>
</table>
<h3>CQL (Cassandra Query Language)</h3>
<table>
<thead>
<tr>
<th>Command</th>
<th>Description</th>
<th>Examples</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>CREATE</code></td>
<td>Use to create a keyspace or table.</td>
<td><code>CREATE KEYSPACE sample WITH REPLICATION = {'class':'SimpleStrategy','replication_factor':3};</code> <br><br> <code>CREATE TABLE my_table (id text, size int, PRIMARY KEY (id))</code></td>
</tr>
<tr>
<td><code>INSERT</code></td>
<td>Use to update or insert table data.</td>
<td><code>INSERT INTO my_table (id) VALUES ('guid');</code></td>
</tr>
</tbody>
</table>
<h2>Junk Drawer</h2>
<p>... All the things that don't have a nice tidy home yet...</p>
<p>All data stored in Cassandra is associated with a token value.</p>
<p>SimpleStrategy</p>
<p>The replication_factor tells cassandra how many copies of each partition in the keyspace to store.</p>
<p><code>create keyspace &lt;keyspace-name&gt; with replication = {'class': 'SimpleStrategy', 'replication_factor': 3};</code></p>
<p>When using NetworkTopologyStrategy, you specify how many copies of each partition to store in each data center.</p>
<p><code>create keyspace &lt;keyspace-name&gt; with replication = {'class': 'NetworkTopologyStrategy', '&lt;dc-name&gt;': 3, '&lt;dc-name&gt;': 2};</code></p>
<p>READS and WRITES</p>
<p>Each node in the cluster functions the same.</p>
<p>The node that you connect to when making a query becomes the 'coordinator node'.</p>
<p>Nodes that get written to in a statement are called replica nodes.</p>
<p>Consistency options: ONE, TWO, THREE, QUORUM, ALL, ANY (any means that just making it to the coordinator node is considered success)</p>
<p>When using multiple data centers, also have these consistency options:</p>
<table>
<thead>
<tr>
<th>Option</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>EACH_QUORUM</code></td>
<td>A quorum succeeds in each data center before returning success</td>
</tr>
<tr>
<td><code>LOCAL_QUORUM</code></td>
<td>A quorum succeeds in the data center that contains the coordinator node.</td>
</tr>
<tr>
<td><code>LOCAL_ONE</code></td>
<td>Same as ONE, but only looks in the data center of the coordinator node.</td>
</tr>
</tbody>
</table>
<p>To see what the default consistency is, run <code>consistency;</code></p>
<p>To set the default consistency to use from the command line, use <code>consistency &lt;level&gt;;</code> e.g. <code>consistency quorum;</code></p></article><div id="sidebar" class="nav tablet-sidebar"><a href="/"><i class="fa fa-home fa-2x"></i><span>tech.joshegan.com</span></a><div class="author-profile"><img alt="author image" src="//www.gravatar.com/avatar/bd6b4be626e8bc1b30161f22a0de08ae?d=404&amp;amp;s=250" class="author-img"><div class="info"><h5>Josh Egan</h5><ul class="social"><li><a href="https://github.com/josh-egan" target="_blank" class="github"><i class="fa fa-github"></i></a></li></ul></div></div></div><div class="mobile-author-profile"><div class="separator"></div><div class="author-profile"><img alt="author image" src="//www.gravatar.com/avatar/bd6b4be626e8bc1b30161f22a0de08ae?d=404&amp;amp;s=250" class="author-img"><div class="info"><h5>Josh Egan</h5><ul class="social"><li><a href="https://github.com/josh-egan" target="_blank" class="github"><i class="fa fa-github"></i></a></li></ul></div></div><div class="separator"></div></div><div><div id="disqus_thread"></div><script type="text/javascript" async="true" src="//tech-joshegan.disqus.com/embed.js"></script><noscript>Please enable JavaScript to view the<a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript></div><div class="separator"></div><footer><div><span>Proudly built with <a href="http://harpjs.com/" target="_blank">harp </a>and hosted on <a href="https://github.com/josh-egan/tech.joshegan.com/tree/master" target="_blank">GitHub</a></span></div></footer></body></html>