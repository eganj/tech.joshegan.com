<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"/><meta http-equiv="X-UA-Compatible" content="IE=edge"/><meta name="HandheldFriendly" content="True"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><meta name="description" content="My collection of notes, resources, and recipes for using mongoDB."/><meta property="og:description" content="My collection of notes, resources, and recipes for using mongoDB."/><meta property="og:site_name" content="tech.joshegan.com"/><meta property="og:title" content="mongoDB Cheatsheet - tech.joshegan.com"><title>mongoDB Cheatsheet - tech.joshegan.com</title><meta property="og:url" content="http://tech.joshegan.com/posts/yr2017/mongodb-cheatsheet"><meta property="og:type" content="article"><link rel="stylesheet" type="text/css" href="/styles/third-party/google-fonts/css/google-fonts.css"/><link rel="stylesheet" type="text/css" href="/styles/third-party/font-awesome-4.3.0/css/font-awesome.min.css"/><link rel="stylesheet" type="text/css" href="/styles/main.css"/><link rel="stylesheet" type="text/css" href="/styles/third-party/highlight-js/hybrid.css"><script src="/scripts/sidebar-opacity.js"></script></head><body id="body" class="post-wrapper"><header class="nav mobile-nav"><a href="/"><i class="fa fa-home fa-2x"></i><span>tech.joshegan.com</span></a></header><article class="post"><h1><a href="http://tech.joshegan.com/posts/yr2017/mongodb-cheatsheet">mongoDB Cheatsheet</a></h1><p></p>Posted on<time datetime="2017-05-05" class="orange"><strong> May 5th, 2017</strong></time><h2>Resources</h2>
<h3>mongoDB</h3>
<ul>
<li><a href="https://docs.mongodb.com/">https://docs.mongodb.com/</a></li>
<li><a href="https://docs.mongodb.com/manual/">https://docs.mongodb.com/manual/</a></li>
<li><a href="https://docs.mongodb.com/getting-started/shell/">https://docs.mongodb.com/getting-started/shell/</a></li>
<li><a href="https://university.mongodb.com/">https://university.mongodb.com/</a></li>
<li><a href="https://www.tutorialspoint.com/mongodb/">https://www.tutorialspoint.com/mongodb/</a></li>
</ul>
<h3>mongoose</h3>
<ul>
<li><a href="http://mongoosejs.com/index.html">http://mongoosejs.com/index.html</a></li>
<li><a href="http://mongoosejs.com/docs/guide.html">http://mongoosejs.com/docs/guide.html</a></li>
</ul>
<h2>About</h2>
<h3>What sets mongo apart?</h3>
<ul>
<li>noSQL</li>
<li>document store</li>
<li>Schema-less. A given collection can hold documents of differing schemas.</li>
</ul>
<h3>History</h3>
<blockquote>
<p>The company was first established in 2007 as 10gen. Based in New York City, 10gen was founded by former DoubleClick founder and CTO Dwight Merriman and former DoubleClick CEO and Gilt Groupe founder Kevin P. Ryan with former Doubleclick engineer and ShopWiki founder and CTO Eliot Horowitz and received $81 million in venture capital funding from Flybridge Capital Partners, In-Q-Tel, Intel Capital, New Enterprise Associates (NEA), Red Hat, Sequoia Capital, and Union Square Ventures. 10gen originally aimed to build a platform as a service architecture based entirely on open source components; however, the company was unable to find an existing database platform that met their &quot;principles&quot; for a cloud architecture. As a result, the company began to develop a document-oriented database system it called MongoDB. After realizing the potential of the software on its own, 10gen's team decided to scrap its cloud platform and focus on maintaining MongoDB instead. - <a href="https://en.wikipedia.org/wiki/MongoDB_Inc.#History">Wikipedia</a></p>
</blockquote>
<h3>Terminology</h3>
<table>
<thead>
<tr>
<th>Term</th>
<th>Definition</th>
</tr>
</thead>
<tbody>
<tr>
<td>Database</td>
<td>A physical container for collections. Each database gets its own set of files on the file system. A single MongoDB server typically has multiple databases.</td>
</tr>
<tr>
<td>Collection</td>
<td>A group of MongoDB documents. It is the equivalent of an RDBMS table.</td>
</tr>
<tr>
<td>Document</td>
<td>A set of key-value pairs. Documents have dynamic schema. Dynamic schema means that documents in the same collection do not need to have the same set of fields or structure, and common fields in a collection's documents may hold different types of data. A document is the equivalent of an RDBMS row.</td>
</tr>
<tr>
<td>Field</td>
<td>A key-value pair of data within a document. A field is the equivalent of an RDBMS column.</td>
</tr>
</tbody>
</table>
<h2>Installation</h2>
<p><a href="https://docs.mongodb.com/manual/installation/">https://docs.mongodb.com/manual/installation/</a></p>
<p>Installation on a mac:</p>
<pre><code class="language-bash">brew update
brew install mongodb
brew services start mongodb
</code></pre>
<p>The default port on a mongo installation is <code>27017</code>.</p>
<h2>mongoDB CLI</h2>
<p><a href="https://docs.mongodb.com/manual/reference/mongo-shell/">https://docs.mongodb.com/manual/reference/mongo-shell/</a></p>
<p>The mongo shell is an interactive javascript shell. All of the commands are implemented in javascript. To see an implementation of a function, just leave off the parentheses and the function definition will be printed to the console.</p>
<p>Launch the mongoDB shell:</p>
<pre><code class="language-bash">mongo
mongo --help
mongo -u username -p password --port <span class="hljs-number">12345</span> --host localhost
mongo --shell my-script.js
mongo localhost:<span class="hljs-number">27017</span>/myDatabase my-script.js
</code></pre>
<p>To exit the mongo shell type <code>exit</code>, type <code>quit()</code>, or use the keyboard shortcut <code>Ctrl+C</code>.</p>
<p>For a full list of options available when launching mongo see <a href="https://docs.mongodb.com/manual/reference/program/mongo/#bin.mongo">https://docs.mongodb.com/manual/reference/program/mongo/#bin.mongo</a>.</p>
<h3>Customize the Prompt</h3>
<p>The prompt can be customized! That's cool. Full docs: <a href="https://docs.mongodb.com/manual/tutorial/configure-mongo-shell/#customize-the-prompt">https://docs.mongodb.com/manual/tutorial/configure-mongo-shell/#customize-the-prompt</a></p>
<ol>
<li>Open (create first if needed) your <a href="https://docs.mongodb.com/manual/reference/program/mongo/#mongo-mongorc-file"><code>~/.mongorc.js</code></a> file.</li>
<li>Add a function named <code>prompt</code>. This function must return a string.</li>
<li>It appears that this function has access to all of the commands that are available in the mongo CLI, so you can really make this thing display anything you can dream up.</li>
<li>If you want to use a special function like <code>show</code>, you'll need to use the JavaScript equivalent of the shell command. A list of equivalents can be found here: <a href="https://docs.mongodb.com/manual/tutorial/write-scripts-for-the-mongo-shell/#differences-between-interactive-and-scripted-mongo">https://docs.mongodb.com/manual/tutorial/write-scripts-for-the-mongo-shell/#differences-between-interactive-and-scripted-mongo</a></li>
</ol>
<p>If I end up doing much work from the command line hitting production boxes, I can imagine this being very useful. I could customize the output based on which host I'm on as a way to constantly remind me which database I'm connected to.</p>
<p>Here's the function I currently have in my <code>.mongorc.js</code> file:</p>
<pre><code class="language-js"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">prompt</span> (<span class="hljs-params"></span>) </span>{
  <span class="hljs-keyword">return</span> <span class="hljs-string">'\n\n'</span> + db + <span class="hljs-string">' &gt; '</span>
}
</code></pre>
<h3>Root Commands</h3>
<table>
<thead>
<tr>
<th>Command</th>
<th>Notes</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>help</code></td>
<td>Prints the help docs for the root commands.</td>
</tr>
<tr>
<td><code>exit</code></td>
<td>Close the mongo db shell.</td>
</tr>
<tr>
<td><code>quit()</code></td>
<td>Another way to close the shell.</td>
</tr>
</tbody>
</table>
<h3>Database Commands</h3>
<table>
<thead>
<tr>
<th>Command</th>
<th>Notes</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>db</code></td>
<td>Displays the database that you're currently using.</td>
</tr>
<tr>
<td><code>show dbs</code></td>
<td>Displays the databases available on the server.</td>
</tr>
<tr>
<td><code>use &lt;db&gt;</code></td>
<td>Set the named database as the current database.</td>
</tr>
<tr>
<td><code>db.help()</code></td>
<td>Print the help docs for all of the database commands.</td>
</tr>
<tr>
<td><code>db.stats()</code></td>
<td>Print the stats for the current database.</td>
</tr>
</tbody>
</table>
<h3>Collection Commands</h3>
<p>In this section, <code>cn</code> is used as an abbreviation for <code>collectionName</code>.</p>
<table>
<thead>
<tr>
<th>Command</th>
<th>Notes</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>show collections</code></td>
<td>Prints the list of collections in the current database.</td>
</tr>
<tr>
<td><code>db.collection.help()</code></td>
<td>Print the help docs for methods available on collection objects.</td>
</tr>
<tr>
<td><code>db.&lt;cn&gt;.&lt;method&gt;()</code></td>
<td>To execute a method on a collection, the name of the collection is used on the <code>db</code> object. e.g. <code>db.users.stats()</code></td>
</tr>
<tr>
<td><code>db.&lt;cn&gt;.insertOne({key: 'value'})</code></td>
<td>Create a single document. If the collection does not exist, it will be created. Use JavaScript object syntax.</td>
</tr>
<tr>
<td><code>db.&lt;cn&gt;.insertMany([])</code></td>
<td>Create many documents. Supply an array of objects.</td>
</tr>
<tr>
<td><code>db.&lt;cn&gt;.find()</code></td>
<td>Retrieve documents. This method has a lot going on. See the section below dedicated specifically to this <code>find</code> method.</td>
</tr>
</tbody>
</table>
<h4><code>db.&lt;cn&gt;.find()</code></h4>
<p>The find method is one of the more complex collection methods, so it gets its own section here in the post. Complex methods have their own help docs. The <code>find</code> help docs can be accessed via: <code>db.collection.find().help()</code></p>
<p>Here's some seed data that can be used to try out these commands on:</p>
<pre><code class="language-javascript">db.inventory.insertMany([
   { item: <span class="hljs-string">"journal"</span>, qty: <span class="hljs-number">25</span>, size: { h: <span class="hljs-number">14</span>, w: <span class="hljs-number">21</span>, uom: <span class="hljs-string">"cm"</span> }, status: <span class="hljs-string">"A"</span> },
   { item: <span class="hljs-string">"notebook"</span>, qty: <span class="hljs-number">50</span>, size: { h: <span class="hljs-number">8.5</span>, w: <span class="hljs-number">11</span>, uom: <span class="hljs-string">"in"</span> }, status: <span class="hljs-string">"A"</span> },
   { item: <span class="hljs-string">"paper"</span>, qty: <span class="hljs-number">100</span>, size: { h: <span class="hljs-number">8.5</span>, w: <span class="hljs-number">11</span>, uom: <span class="hljs-string">"in"</span> }, status: <span class="hljs-string">"D"</span> },
   { item: <span class="hljs-string">"planner"</span>, qty: <span class="hljs-number">75</span>, size: { h: <span class="hljs-number">22.85</span>, w: <span class="hljs-number">30</span>, uom: <span class="hljs-string">"cm"</span> }, status: <span class="hljs-string">"D"</span> },
   { item: <span class="hljs-string">"postcard"</span>, qty: <span class="hljs-number">45</span>, size: { h: <span class="hljs-number">10</span>, w: <span class="hljs-number">15.25</span>, uom: <span class="hljs-string">"cm"</span> }, status: <span class="hljs-string">"A"</span> }
]);
</code></pre>
<p>The anatomy of the find method:</p>
<p><code>var cursor = find(&lt;predicate&gt;, &lt;projection&gt;)</code></p>
<h5>The predicate</h5>
<p>The find predicate is used to define query criteria. The full <a href="https://docs.mongodb.com/manual/tutorial/query-documents/">query help docs</a>.</p>
<table>
<thead>
<tr>
<th>mongo query</th>
<th>SQL equivalent</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>db.inventory.find({})</code></td>
<td><code>SELECT * FROM inventory</code></td>
</tr>
<tr>
<td><code>db.inventory.find({ status: 'D' })</code></td>
<td><code>SELECT * FROM inventory WHERE status = &quot;D&quot;</code></td>
</tr>
<tr>
<td><code>db.inventory.find({ item: { $in: ['paper', 'planner'] } })</code></td>
<td><code>SELECT * FROM inventory WHERE item IN (&quot;paper&quot;, &quot;planner&quot;)</code></td>
</tr>
<tr>
<td><code>db.inventory.find({ status: 'A', qty: { $lt: 48 } })</code></td>
<td><code>SELECT * FROM inventory WHERE status = &quot;A&quot; AND qty &lt; 48</code></td>
</tr>
<tr>
<td><code>db.inventory.find({ $or: [ { status: 'A' }, { qty: { $gt: 90 } } ] })</code></td>
<td><code>SELECT * FROM inventory WHERE status = &quot;A&quot; OR qty &gt; 90</code></td>
</tr>
<tr>
<td><code>db.inventory.find({ item: /^p/, $or: [ { status: 'A' }, { qty: { $gt: 90 } } ] })</code></td>
<td><code>SELECT * FROM inventory WHERE item LIKE &quot;p%&quot; AND (status = &quot;A&quot; OR qty &gt; 90)</code></td>
</tr>
</tbody>
</table>
<p><a href="https://docs.mongodb.com/manual/reference/operator/query-comparison/">Query operators</a>: <code>$eq</code>, <code>$ne</code>, <code>$gt</code>, <code>$gte</code>, <code>$lt</code>, <code>$lte</code>, <code>$in</code>, <code>$nin</code></p>
<h5>The projection</h5>
<p>Projection is used to transform the found object into a new object. Projection can be used to include or exclude fields, rename fields, and also to do simple transformations.</p>
<p>To include a field use a <code>1</code>, to exclude a field use a <code>0</code>. A projection cannot have a mixture of inclusions and exclusions, although you can exclude the <code>_id</code> field.</p>
<table>
<thead>
<tr>
<th>mongo query</th>
<th>SQL equivalent</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>db.inventory.find({})</code></td>
<td><code>SELECT * FROM inventory</code></td>
</tr>
<tr>
<td><code>db.inventory.find({}, { item: 1, status: 1 })</code></td>
<td><code>SELECT _id, item, status FROM inventory</code></td>
</tr>
<tr>
<td><code>db.inventory.find({}, { _id: 0, item: 1 })</code></td>
<td><code>SELECT item FROM inventory</code></td>
</tr>
<tr>
<td><code>db.inventory.find({}, { _id: 0, size: 0 })</code></td>
<td><code>SELECT item, qty, status FROM inventory</code></td>
</tr>
<tr>
<td><code>db.inventory.find({}, { _id: 0, &quot;size.uom&quot;: 1 })</code></td>
<td></td>
</tr>
<tr>
<td><code>db.inventory.find({}, { _id: 0, itemName: &quot;$item&quot; })</code></td>
<td></td>
</tr>
</tbody>
</table>
<h5>The cursor</h5>
<p>The <code>find()</code> method returns a cursor. There are a <a href="https://docs.mongodb.com/manual/reference/method/js-cursor/">whole bunch</a> of cursor methods. Some of the cursor methods include: <code>sort</code>, <code>limit</code>, <code>min</code>, <code>max</code>, and <code>forEach</code></p>
<p><code>db.inventory.find({}).limit(3).sort({ qty: 1})</code></p>
<h2>Core Concepts</h2>
<h3>Documents</h3>
<p>Every document contains a unique <code>_id</code> field. This field can be provided when inserting a document. If this field is not provided, then it will be automatically created. The <code>_id</code> field is a 12 byte hexadecimal number.</p>
<h3>Aggregation</h3>
<ul>
<li><a href="https://docs.mongodb.com/manual/reference/operator/aggregation/">https://docs.mongodb.com/manual/reference/operator/aggregation/</a></li>
</ul>
<h4>Projection Operator</h4>
<p>Within aggregation, projection can do more than within a find() command. Aggregation projection docs are <a href="https://docs.mongodb.com/manual/reference/operator/aggregation/project/">here</a>.</p></article><div id="sidebar" class="nav tablet-sidebar"><a href="/"><i class="fa fa-home fa-2x"></i><span>tech.joshegan.com</span></a><div class="author-profile"><img alt="author image" src="//www.gravatar.com/avatar/bd6b4be626e8bc1b30161f22a0de08ae?d=404&amp;amp;s=250" class="author-img"><div class="info"><h5>Josh Egan</h5><ul class="social"><li><a href="https://github.com/josh-egan" target="_blank" class="github"><i class="fa fa-github"></i></a></li></ul></div></div></div><div class="mobile-author-profile"><div class="separator"></div><div class="author-profile"><img alt="author image" src="//www.gravatar.com/avatar/bd6b4be626e8bc1b30161f22a0de08ae?d=404&amp;amp;s=250" class="author-img"><div class="info"><h5>Josh Egan</h5><ul class="social"><li><a href="https://github.com/josh-egan" target="_blank" class="github"><i class="fa fa-github"></i></a></li></ul></div></div><div class="separator"></div></div><div><div id="disqus_thread"></div><script type="text/javascript" async="true" src="//tech-joshegan.disqus.com/embed.js"></script><noscript>Please enable JavaScript to view the<a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript></div><div class="separator"></div><footer><div><span>Proudly built with <a href="http://harpjs.com/" target="_blank">harp </a>and hosted on <a href="https://github.com/josh-egan/tech.joshegan.com/tree/master" target="_blank">GitHub</a></span></div></footer></body></html>