<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta http-equiv="Content-Security-Policy" content="upgrade-insecure-requests"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="HandheldFriendly" content="True"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="description" content="Some details and thoughts on the practice of Test-Driven Development."><meta property="og:description" content="Some details and thoughts on the practice of Test-Driven Development."><meta property="og:site_name" content="tech.joshegan.com"><link rel="stylesheet" type="text/css" href="/styles/third-party/google-fonts/css/google-fonts.css"><link rel="stylesheet" type="text/css" href="/styles/third-party/font-awesome-4.3.0/css/font-awesome.min.css"><link rel="stylesheet" type="text/css" href="/styles/main.css"><meta property="og:title" content="Details on TDD - tech.joshegan.com"><title>Details on TDD - tech.joshegan.com</title><meta property="og:url"><meta property="og:type" content="article"><link rel="stylesheet" type="text/css" href="/styles/third-party/highlight-js/hybrid.css"><script src="/scripts/sidebar-opacity.js"></script></head><body><div class="post-wrapper"><header class="nav mobile-nav"><a href="/"><i class="fa fa-home fa-2x"></i><span>tech.joshegan.com</span></a></header><article class="post"><h1><a>Details on TDD</a></h1><p>Posted on&nbsp;<time datetime="2017-04-12"><strong>Apr 12th, 2017</strong></time>, updated on&nbsp;<time datetime="2017-06-16" class="orange"><strong>Jun 16th, 2017</strong></time></p><p>I was already familiar with unit testing and the concept of TDD (Test-Driven Development) before I started at Pluralsight, but I soon realized that my understanding was just scratching the surface. I have learned much more on this subject so I wanted to do a quick write-up on what I have learned.</p>
<ul>
<li><a href="http://coding-is-like-cooking.info/2013/04/outside-in-development-with-double-loop-tdd/">Double Loop TDD</a></li>
<li><a href="https://martinfowler.com/bliki/TestPyramid.html">Testing Pyramid</a></li>
<li>Clear definitions of different types of tests
<ol>
<li>UI: These tests run against the UI in our staging environment. Nothing is mocked. These tests ensure that everything is working together as expected. These are the most fragile tests and we therefore only test critical paths with these type of tests. For web UI tests, we use tools like <a href="http://docs.seleniumhq.org/">Selenium</a>, <a href="http://nightwatchjs.org/">Nightwatch</a>, and <a href="https://saucelabs.com/">SauceLabs</a>.</li>
<li>Acceptance: These tests are for a single application to ensure that everything in an application is working as expected. Nothing is mocked for these tests. For example, all of our APIs have acceptance tests that make a single happy path pass through each endpoint to ensure that everything is working together as expected. One of the awesome things about Node.js is that our acceptance tests start the api server locally, run the tests, and then shut the server down after the tests have run. So awesome.</li>
<li>Integration: These tests cross exactly one boundary to ensure that an integration with a third party service is working as expected. Typically, integration tests are used for external services (databases, apis, etc.) that require some kind of setup in order to ensure that the service is running prior to executing the tests. For example, a repository that accesses the database would have integration tests to thoroughly test (as thouroughly as we do when unit testing) all the expected usages and edge cases for interacting with the database. These tests never have anything mocked because we <a href="https://github.com/testdouble/contributing-tests/wiki/Don%27t-mock-what-you-don%27t-own">don't mock what we don't own</a>.</li>
<li>Unit: Finally, unit tests are for thoroughly testing all possible outcomes with <em>our</em> code. These tests mock out dependencies and test isolated chunks of code. Again, we don't mock what we don't own.</li>
</ol>
</li>
</ul>
<p>For our acceptance, integration, and unit tests, we use the following libraries:</p>
<ul>
<li><a href="http://mochajs.org/">mocha</a> with <code>bdd</code> style.</li>
<li><a href="http://chaijs.com/">chai</a> with the <code>expect</code> assertions because <code>expect(undefined).to.equal('foo')</code> will execute whereas <code>undefined.should.equal('foo')</code> will explode. We also use the <a href="http://chaijs.com/plugins/chai-as-promised/">chai-as-promised</a> plugin.</li>
<li><a href="https://github.com/testdouble/testdouble.js">testdouble</a> for mocking. We used to use sinon.js but changed over because we were feeling many of <a href="http://blog.testdouble.com/posts/2016-03-13-testdouble-vs-sinon.html">these</a> pain points.</li>
</ul>
<p>We use the following tools for executing our tests:</p>
<ul>
<li><a href="https://www.jetbrains.com/webstorm/">Webstorm</a> has an excellent built in test runner that works seamlessly with <code>mocha</code>. One of the best parts of using Webstorm to run tests is having clickable links in the stack traces.</li>
<li><a href="https://wallabyjs.com/">Wallaby.js</a> is a continuous test runner that integrates with numerous text editors. I used this heavily for about 6 months, and it was awesome, but in the end this tool fell out of use because it was too much work to keep it configured on all of the workstations. (At Pluralsight, no one on our team has a desk - we pair / mob everyday so there is no personal space. Consequently, keeping wallaby running required configuring it on every workstation for every project, and the overhead grew to be too tiring for me and outweighed the benefits. Just using the Webstorm runner in continuous execution mode has been good enough for me.)</li>
<li>We also occasionally use the good 'ole watch mode that is build into mocha.</li>
</ul>
<p>We've had lots of discussions about how to test and what to test. The purpose of testing is to deliver features faster with very few bugs. So our tests are written with that end-goal in mind. We generally follow the shape of the testing pyramid; in other words we typically test in a (off the cuff) ratio of 50:15:5:1. However, like most things, there are exceptions to every rule. For example, in one project, we have abstracted most of the functionality into re-usable, private npm packages because each implementation was so similar. Each npm package is thoroughly unit tested, so in that project we only have acceptance tests and the acceptance tests cover all of the possible paths. We have found that even though the acceptance tests take a little longer to run than unit tests, it's faster in the end to write and maintain these tests for this particular project.</p>
<p>Some tips for making npm scripts work well:</p>
<ul>
<li>Use escaped double quotes around file blobs to ensure that they work on Mac, PC, and Linux.</li>
<li>Use <code>|| true</code> at the end of your test script to prevent npm from puking all of the error output at the end of a failed test.</li>
<li>Make sure <em>not</em> to use <code>|| true</code> if your test script is going to be run in a tool like TeamCity where a failure needs to be meaningful.</li>
</ul>
<pre><code class="language-json">{
  "<span class="hljs-attribute">scripts</span>": <span class="hljs-value">{
    "<span class="hljs-attribute">test</span>": <span class="hljs-value"><span class="hljs-string">"./node_modules/.bin/mocha \"./src/**/*.specs.js\""</span></span>,
    "<span class="hljs-attribute">test-watch</span>": <span class="hljs-value"><span class="hljs-string">"npm test -- -w"</span></span>,
    "<span class="hljs-attribute">test-teamcity</span>": <span class="hljs-value"><span class="hljs-string">"npm test -- --reporter mocha-teamcity-reporter"</span></span>,
    "<span class="hljs-attribute">ti</span>": <span class="hljs-value"><span class="hljs-string">"./node_modules/.bin/mocha ./test/database-setup.js \"./src/**/*.i-specs.js\" || true"</span></span>,
    "<span class="hljs-attribute">ti-watch</span>": <span class="hljs-value"><span class="hljs-string">"npm run test-integration -- -w"</span></span>,
    "<span class="hljs-attribute">test-integration</span>": <span class="hljs-value"><span class="hljs-string">"./node_modules/.bin/mocha ./test/database-setup.js \"./src/**/*.i-specs.js\""</span></span>,
    "<span class="hljs-attribute">test-integration-teamcity</span>": <span class="hljs-value"><span class="hljs-string">"npm run test-integration -- --reporter mocha-teamcity-reporter"</span></span>,
    "<span class="hljs-attribute">ta</span>": <span class="hljs-value"><span class="hljs-string">"./node_modules/.bin/mocha \"./src/**/*.a-specs.js\" || true"</span></span>,
    "<span class="hljs-attribute">test-acceptance</span>": <span class="hljs-value"><span class="hljs-string">"./node_modules/.bin/mocha \"./src/**/*.a-specs.js\""</span></span>,
    "<span class="hljs-attribute">test-acceptance-teamcity</span>": <span class="hljs-value"><span class="hljs-string">"npm run test-acceptance -- --reporter mocha-teamcity-reporter"</span></span>,
    "<span class="hljs-attribute">test-all</span>": <span class="hljs-value"><span class="hljs-string">"npm test &amp;&amp; npm run test-integration &amp;&amp; npm run test-acceptance"</span>
  </span>}
</span>}
</code></pre></article><div id="sidebar" class="nav tablet-sidebar"><a href="/"><i class="fa fa-home fa-2x"></i><span>tech.joshegan.com</span></a><div class="author-profile"><img alt="author image" src="//www.gravatar.com/avatar/bd6b4be626e8bc1b30161f22a0de08ae?d=404&amp;amp;s=250" class="author-img"><div class="info"><h5>Josh Egan</h5><ul class="social"><li><a href="https://github.com/josh-egan" target="_blank" class="github"><i class="fa fa-github"></i></a></li></ul></div></div></div><div class="mobile-author-profile"><div class="separator"></div><div class="author-profile"><img alt="author image" src="//www.gravatar.com/avatar/bd6b4be626e8bc1b30161f22a0de08ae?d=404&amp;amp;s=250" class="author-img"><div class="info"><h5>Josh Egan</h5><ul class="social"><li><a href="https://github.com/josh-egan" target="_blank" class="github"><i class="fa fa-github"></i></a></li></ul></div></div><div class="separator"></div></div><div><div id="disqus_thread"></div><script type="text/javascript" async="true" src="//tech-joshegan.disqus.com/embed.js"></script><noscript>Please enable JavaScript to view the<a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript></div></div><div class="separator"></div><footer><div><span>Proudly built with <a href="http://harpjs.com/" target="_blank">harp </a>and hosted on <a href="https://github.com/josh-egan/tech.joshegan.com/tree/master" target="_blank">GitHub</a></span></div></footer></body></html>